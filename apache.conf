# Apache configuration for Lyra Documentation
# Place this in /etc/apache2/sites-available/lyra-docs.conf
# Then enable with: a2ensite lyra-docs

<VirtualHost *:80>
    ServerName docs.lyra.ovh
    ServerAdmin admin@lyra.ovh

    # Redirect HTTP to HTTPS
    Redirect permanent / https://docs.lyra.ovh/
</VirtualHost>

<VirtualHost *:443>
    ServerName docs.lyra.ovh
    ServerAdmin admin@lyra.ovh

    # SSL Configuration (adjust paths to your certificates)
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/lyra-docs.crt
    SSLCertificateKeyFile /etc/ssl/private/lyra-docs.key
    SSLCertificateChainFile /etc/ssl/certs/lyra-docs-chain.crt

    # SSL Security Settings
    SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite HIGH:!aNULL:!MD5
    SSLHonorCipherOrder on

    # Document Root
    DocumentRoot /var/www/lyra-docs

    <Directory /var/www/lyra-docs>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted

        # Rewrite rules for clean URLs
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*)$ index.html [L]
    </Directory>

    # Security Headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "no-referrer-when-downgrade"

    # Cache static assets
    <FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$">
        Header set Cache-Control "max-age=31536000, public, immutable"
    </FilesMatch>

    # Gzip Compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
        AddOutputFilterByType DEFLATE text/javascript application/javascript application/json
        AddOutputFilterByType DEFLATE application/xml application/rss+xml
        AddOutputFilterByType DEFLATE image/svg+xml
    </IfModule>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/lyra-docs-error.log
    CustomLog ${APACHE_LOG_DIR}/lyra-docs-access.log combined

    # Deny access to hidden files
    <DirectoryMatch "^\.|\/\.">
        Require all denied
    </DirectoryMatch>
</VirtualHost>

# Required Apache modules:
# a2enmod ssl rewrite headers deflate
